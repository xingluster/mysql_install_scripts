# 使用说明

#### 服务主机
运行安装脚本的主节点

#### 目标机器
安装MySQL的目标节点

### 安装要求
- 服务主机必须是一台linux机上，最好是REHL.7版本，如果是6,则需要手动安装sshpass组件
- 确保服务主机上安装有openssh-clients等组件，可以在服务器上提前运行 *yum -y install openssh-clients sshpass*
- 服务主机必须已经有默认的ssh公钥，即存在～/.ssh/id_rsa和～/.ssh/id_rsa.pub文件，如果没有，则需要调用ssh-keygen生成，参考小节 *服务主机生成密钥*
- 服务主机本地目录应该有官方的MySQL安装介质，版本为通用的linux-glibc-64位的tar.gz格式, 特别注意不是源码也不是rpm格式
- 目标机器应该提供root密码，如果没有root密码，服务器至少应该可以使用root免密登录到目标机器

### 服务主机生成密钥
请使用ssh-keygen命令生成密钥对，如果该命令不存在，则需要安装openssh组件(yum install -y openssh)

### 免密登录
如果知道目标机器的root密码，则可以使用keys.sh脚本，设置免密登录  
调用方式，支持多个ip地址同时设置：  

　　`./keys.sh root密码 ip地址1`

参数1是目标机器的root密码，参数2是目标机器的ip地址  

如果多台目标机器的root密码相同，则可以一次调用，使用方式如下：  

　　`./keys.sh root密码 ip地址1 ip地址2 ip地址3...`

调用完毕后，服务主机的服务主机可以使用`ssh root@ip地址`登录到远程目标机器上

### 安装 MySQL Group Replication 示例：

假设目标机器为三台：172.17.0.2, 172.17.0.3, 172.17.0.4  
假设三台目标机器的root密码均为password

调用 *keys.sh* 打通服务主机到目标机器的免密登录  

```shell
./keys.sh password 172.17.0.2 172.17.0.3 172.17.0.4
```

参数说明：  
- 参数1： 目标机器的root密码
- 参数2+： 目标机器列表

调用脚本 *install.sh* 进行安装：  

```shell
./install.sh \
	mysql-5.7.20-linux-glibc2.12-x86_64.tar.gz \
	5.7.20 \
	3306 \
	33061 \
	/appdata/mgrprofile \
	/appdata/mgrdata \
	172.17.0.2 \
  172.17.0.3 \
  172.17.0.4
```

- 参数1： MySQL安装介质的文件名，如果在sh脚本当前目录，可以不带路径，否则需要带路径，支持相对路径和绝对路径,要求是官网的tar.gz格式
- 参数2： MySQL安装版本,关系到目标机器的程序安装目录名
- 参数3： MySQL客户端监听端口,即客户端配置需要连接的服务器端口，通常是3306
- 参数4： MySQL MGR内部通信端口，通常是33061
- 参数5： 目标机器准备将my.cnf文件存放的位置
- 参数6： 目标机器准备将数据文件,日志文件存放的位置
- 参数7+： 目标机器列表，支持1～9个节点

### 其他
如果疑问，请联系 *邢路*
